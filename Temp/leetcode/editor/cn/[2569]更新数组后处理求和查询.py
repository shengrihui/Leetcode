# 2569 æ›´æ–°æ•°ç»„åå¤„ç†æ±‚å’ŒæŸ¥è¯¢
from typing import *
from collections import *
from itertools import *
from functools import *
from math import *
import heapq


# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def handleQuery(self, nums1: List[int], nums2: List[int], queries: List[List[int]]) -> List[int]:
        # æ“ä½œ1ï¼šå°† nums1 çš„ [l,r] çš„ 0/1 ç¿»è½¬
        # æ“ä½œ3ï¼šè¾“å‡º nums2 çš„å’Œ
        # æ‰€ä»¥ nums2 æ¯ä¸€ä¸ªå€¼æ˜¯å¤šå°‘å¹¶ä¸é‡è¦ï¼Œå…³æ³¨ nums2 çš„å’Œï¼ˆç”¨ä¸€ä¸ªå˜é‡è®°å½•ï¼‰
        # æ“ä½œ2çš„ä½œç”¨å°±æ˜¯å°† nums1 çš„å’Œçš„ p å€åŠ åˆ° nums2 çš„å’Œä¸Šå»
        # cnt1[o]ï¼šç¼–å·ä¸º o çš„èŠ‚ç‚¹çš„åŒºé—´1çš„ä¸ªæ•°
        # flip[o]ï¼šç¼–å·ä¸º o çš„èŠ‚ç‚¹çš„åŒºé—´é‡Œæ˜¯å¦è¿›è¡Œäº† 0/1 ç¿»è½¬
        n = len(nums1)
        cnt1 = [0] * (4 * n)
        flip = [False] * (4 * n)

        def maintain(o: int) -> int:
            # è®¡ç®—èŠ‚ç‚¹ç¼–å·ä¸º o æ‰€ä»£è¡¨çš„åŒºé—´é‡Œæœ‰å¤šå°‘1
            # ä¹Ÿå°±æ˜¯èŠ‚ç‚¹ o çš„å·¦å³å„¿å­çš„ cnt1 å’Œ
            # åœ¨ build å’Œ update çš„æ—¶å€™ç”¨
            cnt1[o] = cnt1[o * 2] + cnt1[o * 2 + 1]

        def build(o: int, l: int, r: int) -> None:
            # oï¼šå½“å‰èŠ‚ç‚¹ç¼–å·ï¼›lï¼Œr:å½“å‰èŠ‚ç‚¹çš„åŒºé—´èŒƒå›´
            if l == r:  # å½“åŒºé—´é•¿åº¦åªæœ‰1çš„æ—¶å€™ï¼Œåœæ­¢é€’å½’
                # è¿™é“é¢˜æ˜¯è¦ç»´æŠ¤åŒºé—´å†…æœ‰å¤šå°‘ä¸ª1
                # æ‰€ä»¥å½“ l == rï¼Œcnt1[o] å°±æ˜¯å¯¹åº” nums1 çš„å€¼
                # l-1 æ˜¯å› ä¸ºåœ¨çº¿æ®µæ ‘é‡Œï¼ŒåŒºé—´ä¸‹æ ‡ä»1å¼€å§‹
                cnt1[o] = nums1[l - 1]
                return
            m = (l + r) // 2
            build(o * 2, l, m)  # å·¦å„¿å­
            build(o * 2 + 1, m + 1, r)  # å³å„¿å­
            maintain(o)

        def do(o: int, l: int, r: int) -> None:
            # å¯¹ç¼–å·ä¸º o çš„èŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œ
            # åœ¨ update é‡Œç”¨
            # åœ¨è¿™é“é¢˜é‡Œ
            # æ›´æ–°æ“ä½œæ˜¯æ“ä½œ1å¹²çš„ç¿»è½¬ 0/1
            # ä¸€ä¸ªåŒºé—´çš„ 0/1 åè½¬äº†ï¼Œcnt1[0] å˜ä¸º åŒºé—´é•¿åº¦ - åŸæ¥æœ‰å¤šå°‘ä¸ª1
            cnt1[o] = r - l + 1 - cnt1[o]
            # flip[o] å–åå³å¯
            flip[o] = not flip[o]

        def update(o: int, l: int, r: int, L: int, R: int) -> None:
            # oï¼šå½“å‰èŠ‚ç‚¹ç¼–å·ï¼›
            # lï¼Œr:å½“å‰èŠ‚ç‚¹çš„åŒºé—´èŒƒå›´
            # L,Rï¼šè¦æ›´æ–°çš„åŒºé—´çš„èŒƒå›´
            if l >= L and r <= R:
                # å½“å‰èŠ‚ç‚¹å®Œå…¨åœ¨è¦æ›´æ–°çš„åŒºé—´èŒƒå›´é‡Œ(åŒºé—´å†…æ‰€æœ‰çš„ç‚¹éƒ½è¦è¿›è¡Œæ›´æ–°)
                # é‚£å°±å¯¹è¿™ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œä¹‹åå°± returnï¼Œä¸åœ¨ç»§ç»­é€’å½’ä¸‹å»
                do(o, l, r)
                return
            # æ²¡æœ‰è¿›å…¥ä¸Šé¢è¿™ä¸ª if-returnï¼Œè¯´æ˜
            # è¿™ä¸ªèŠ‚ç‚¹çš„åŒºé—´ [l,r] åŒ…å«äº†ä¸€äº›è¿™æ¬¡æ›´æ–°èŒƒå›´å¤–çš„åŒºé—´
            # è¿˜è¦é€’å½’ä¸‹å»
            m = (l + r) // 2

            # å…ˆå°†æ›´æ–°æ ‡è®°ä¼ é€’ä¸‹å»ï¼Œå¹¶å°† o çš„æ ‡è®°å–æ¶ˆæ‰
            # cnt1[o] çš„ä¿®æ”¹åœ¨æœ€åé¢ï¼Œå·¦å³å„¿å­é€’å½’å®Œäº†å†ç»´æŠ¤
            if flip[o]:
                do(o * 2, l, m)
                do(o * 2 + 1, m + 1, r)
                flip[o] = False

            if not m < L:  # l<m<L ï¼šå·¦å„¿å­æ²¡æœ‰è¦æ›´æ–°çš„åŒºé—´ï¼Œä¸ç”¨ç»§ç»­é€’å½’ä¸‹å»
                update(o * 2, l, m, L, R)  # å·¦å„¿å­
            if not R < m + 1:  # R<m+1<r ï¼šå³å„¿å­æ²¡æœ‰è¦æ›´æ–°çš„åŒºé—´ï¼Œä¸ç”¨ç»§ç»­é€’å½’ä¸‹å»
                update(o * 2 + 1, m + 1, r, L, R)  # å³å„¿å­
            maintain(o)

        build(1, 1, n)  # åˆå§‹åŒ–ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ç¼–å·ä¸º1ï¼ŒåŒºé—´èŒƒå›´ä¸º[1,n]
        ans, s = [], sum(nums2)
        for op, l, r in queries:
            if op == 1:
                update(1, 1, n, l + 1, r + 1)  # +1å› ä¸ºä¸‹æ ‡ä»1å¼€å§‹
            elif op == 2:  # [2,p,0] l==p
                s += l * cnt1[1]  # cnt[1]ä»£è¡¨nums1é‡Œæœ‰æ¯’å°‘ä¸ª1
            elif op == 3:
                ans.append(s)
        return ans
# leetcode submit region end(Prohibit modification and deletion)


# ç»™ä½ ä¸¤ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„æ•°ç»„ nums1 å’Œ nums2 ï¼Œå’Œä¸€ä¸ªäºŒç»´æ•°ç»„ queries è¡¨ç¤ºä¸€äº›æ“ä½œã€‚æ€»å…±æœ‰ 3 ç§ç±»å‹çš„æ“ä½œï¼š 
# 
#  
#  æ“ä½œç±»å‹ 1 ä¸º queries[i] = [1, l, r] ã€‚ä½ éœ€è¦å°† nums1 ä»ä¸‹æ ‡ l åˆ°ä¸‹æ ‡ r çš„æ‰€æœ‰ 0 åè½¬æˆ 1 å¹¶ä¸”æ‰€æœ‰ 1 åè½¬
# æˆ 0 ã€‚l å’Œ r ä¸‹æ ‡éƒ½ä» 0 å¼€å§‹ã€‚ 
#  æ“ä½œç±»å‹ 2 ä¸º queries[i] = [2, p, 0] ã€‚å¯¹äº 0 <= i < n ä¸­çš„æ‰€æœ‰ä¸‹æ ‡ï¼Œä»¤ nums2[i] = nums2[i] +
#  nums1[i] * p ã€‚ 
#  æ“ä½œç±»å‹ 3 ä¸º queries[i] = [3, 0, 0] ã€‚æ±‚ nums2 ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚ 
#  
# 
#  è¯·ä½ è¿”å›ä¸€ä¸ª æ•°ç»„ï¼ŒåŒ…å« æ‰€æœ‰ç¬¬ä¸‰ç§æ“ä½œç±»å‹ çš„ç­”æ¡ˆã€‚ 
# 
#  
# 
#  ç¤ºä¾‹ 1ï¼š 
# 
#  
# è¾“å…¥ï¼šnums1 = [1,0,1], nums2 = [0,0,0], queries = [[1,1,1],[2,1,0],[3,0,0]]
# è¾“å‡ºï¼š[3]
# è§£é‡Šï¼šç¬¬ä¸€ä¸ªæ“ä½œå nums1 å˜ä¸º [1,1,1] ã€‚ç¬¬äºŒä¸ªæ“ä½œåï¼Œnums2 å˜æˆ [1,1,1] ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªæ“ä½œçš„ç­”æ¡ˆä¸º 3 ã€‚æ‰€ä»¥è¿”å› [3] ã€‚
# 
#  
# 
#  ç¤ºä¾‹ 2ï¼š 
# 
#  
# è¾“å…¥ï¼šnums1 = [1], nums2 = [5], queries = [[2,0,0],[3,0,0]]
# è¾“å‡ºï¼š[5]
# è§£é‡Šï¼šç¬¬ä¸€ä¸ªæ“ä½œåï¼Œnums2 ä¿æŒä¸å˜ä¸º [5] ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªæ“ä½œçš„ç­”æ¡ˆæ˜¯ 5 ã€‚æ‰€ä»¥è¿”å› [5] ã€‚
#  
# 
#  
# 
#  æç¤ºï¼š 
# 
#  
#  1 <= nums1.length,nums2.length <= 10âµ 
#  nums1.length = nums2.length 
#  1 <= queries.length <= 10âµ 
#  queries[i].length = 3 
#  0 <= l <= r <= nums1.length - 1 
#  0 <= p <= 10â¶ 
#  0 <= nums1[i] <= 1 
#  0 <= nums2[i] <= 10â¹ 
#  
# 
#  Related Topics çº¿æ®µæ ‘ æ•°ç»„ ğŸ‘ 99 ğŸ‘ 0

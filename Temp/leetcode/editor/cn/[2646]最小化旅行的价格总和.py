# 2646 æœ€å°åŒ–æ—…è¡Œçš„ä»·æ ¼æ€»å’Œ
from typing import List


# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def minimumTotalPrice(self, n: int, edges: List[List[int]], price: List[int], trips: List[List[int]]) -> int:
        g = [[] for _ in range(n)]
        for a, b in edges:
            g[a].append(b)
            g[b].append(a)

        cnt = [0] * n  # æ¯ä¸ªèŠ‚ç‚¹ä¼šç»è¿‡å¤šå°‘æ¬¡
        for start, end in trips:
            # DFS
            # ä» start å¼€å§‹DFSï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ i éå†å®ƒçš„å­èŠ‚ç‚¹ jï¼Œä¸æ–­â€œé€’â€ï¼ˆæ·±å…¥ï¼‰
            # å¦‚æœæŸä¸€æ¡è·¯åˆ°äº† end ï¼Œåˆ™è¿”å› Trueï¼Œå¹¶åœ¨â€œå½’â€çš„æ—¶å€™ç»™è·¯å¾„ä¸Šçš„ cnt åŠ 1
            # å¦‚æœéå†äº†æ‰€æœ‰èŠ‚ç‚¹ j éƒ½æœªèƒ½ return è¯´æ˜è¿™ä¸ª i ä¸åœ¨ start åˆ° end çš„è·¯å¾„ä¸Š
            def cnt_dfs(i: int, fa: int) -> bool:
                if i == end:
                    cnt[i] += 1
                    return True
                for j in g[i]:
                    if j != fa and cnt_dfs(j, i):
                        cnt[i] += 1
                        return True
                return False

            cnt_dfs(start, -1)
            # BFS
            """
            q = deque([(start, [start])])
            while q:
                node, path = q.popleft()
                if node == end:
                    for i in path:
                        cnt[i] += 1
                    break
                for son in g[node]:
                    if son not in path:
                        q.append((son, path + [son]))
            """

        # ç°åœ¨èŠ‚ç‚¹ i éœ€è¦ç»è¿‡ cnt[i] æ¬¡
        # é‚£å°±ç›¸å½“äº i èŠ‚ç‚¹çš„ä»·æ ¼å˜æˆäº† prices[i] * cnt[i] ï¼Œ
        # ä»æœªè®¿é—®è¿‡çš„èŠ‚ç‚¹çš„ä»·æ ¼å°±å˜æˆäº† 0
        # ç°åœ¨å°±æ˜¯è¦é€‰ä¸€éƒ¨åˆ†ä¸ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå°†ä»–ä»¬çš„ä»·æ ¼å‡åŠï¼Œä½¿æ€»å’Œæœ€å°
        def dfs(x: int, fa: int) -> (int, int):
            not_halve = price[x] * cnt[x]  # x èŠ‚ç‚¹çš„â€œæ–°â€ä»·æ ¼
            halve = not_halve // 2  # å‡å¦‚é€‰æ‹© x ä»·æ ¼å‡åŠ
            for y in g[x]:
                if y != fa:
                    nh, h = dfs(y, x)
                    not_halve += nh if nh < h else h  # å¦‚æœ x ä¸é€‰æ‹©å‡åŠï¼Œé‚£ y æ—¢å¯ä»¥å‡åŠä¹Ÿå¯ä»¥ä¸å‡åŠï¼Œå–è¾ƒå°å€¼
                    halve += nh  # x é€‰æ‹©å‡åŠï¼Œy åªèƒ½ä¸å‡åŠ
            return not_halve, halve

        return min(dfs(0, -1))
# leetcode submit region end(Prohibit modification and deletion)


# ç°æœ‰ä¸€æ£µæ— å‘ã€æ— æ ¹çš„æ ‘ï¼Œæ ‘ä¸­æœ‰ n ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‰ä» 0 åˆ° n - 1 ç¼–å·ã€‚ç»™ä½ ä¸€ä¸ªæ•´æ•° n å’Œä¸€ä¸ªé•¿åº¦ä¸º n - 1 çš„äºŒç»´æ•´æ•°æ•°ç»„ edges ï¼Œå…¶ä¸­ 
# edges[i] = [ai, bi] è¡¨ç¤ºæ ‘ä¸­èŠ‚ç‚¹ ai å’Œ bi ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ã€‚ 
# 
#  æ¯ä¸ªèŠ‚ç‚¹éƒ½å…³è”ä¸€ä¸ªä»·æ ¼ã€‚ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ price ï¼Œå…¶ä¸­ price[i] æ˜¯ç¬¬ i ä¸ªèŠ‚ç‚¹çš„ä»·æ ¼ã€‚ 
# 
#  ç»™å®šè·¯å¾„çš„ ä»·æ ¼æ€»å’Œ æ˜¯è¯¥è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„ä»·æ ¼ä¹‹å’Œã€‚ 
# 
#  å¦ç»™ä½ ä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„ trips ï¼Œå…¶ä¸­ trips[i] = [starti, endi] è¡¨ç¤ºæ‚¨ä»èŠ‚ç‚¹ starti å¼€å§‹ç¬¬ i æ¬¡æ—…è¡Œï¼Œå¹¶é€šè¿‡ä»»ä½•
# ä½ å–œæ¬¢çš„è·¯å¾„å‰å¾€èŠ‚ç‚¹ endi ã€‚ 
# 
#  åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ—…è¡Œä¹‹å‰ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº› éç›¸é‚»èŠ‚ç‚¹ å¹¶å°†ä»·æ ¼å‡åŠã€‚ 
# 
#  è¿”å›æ‰§è¡Œæ‰€æœ‰æ—…è¡Œçš„æœ€å°ä»·æ ¼æ€»å’Œã€‚ 
# 
#  
# 
#  ç¤ºä¾‹ 1ï¼š 
#  è¾“å…¥ï¼šn = 4, edges = [[0,1],[1,2],[1,3]], price = [2,2,10,6], trips = [[0,3],[2,
# 1],[2,3]]
# è¾“å‡ºï¼š23
# è§£é‡Šï¼š
# ä¸Šå›¾è¡¨ç¤ºå°†èŠ‚ç‚¹ 2 è§†ä¸ºæ ¹ä¹‹åçš„æ ‘ç»“æ„ã€‚ç¬¬ä¸€ä¸ªå›¾è¡¨ç¤ºåˆå§‹æ ‘ï¼Œç¬¬äºŒä¸ªå›¾è¡¨ç¤ºé€‰æ‹©èŠ‚ç‚¹ 0 ã€2 å’Œ 3 å¹¶ä½¿å…¶ä»·æ ¼å‡åŠåçš„æ ‘ã€‚
# ç¬¬ 1 æ¬¡æ—…è¡Œï¼Œé€‰æ‹©è·¯å¾„ [0,1,3] ã€‚è·¯å¾„çš„ä»·æ ¼æ€»å’Œä¸º 1 + 2 + 3 = 6 ã€‚
# ç¬¬ 2 æ¬¡æ—…è¡Œï¼Œé€‰æ‹©è·¯å¾„ [2,1] ã€‚è·¯å¾„çš„ä»·æ ¼æ€»å’Œä¸º 2 + 5 = 7 ã€‚
# ç¬¬ 3 æ¬¡æ—…è¡Œï¼Œé€‰æ‹©è·¯å¾„ [2,1,3] ã€‚è·¯å¾„çš„ä»·æ ¼æ€»å’Œä¸º 5 + 2 + 3 = 10 ã€‚
# æ‰€æœ‰æ—…è¡Œçš„ä»·æ ¼æ€»å’Œä¸º 6 + 7 + 10 = 23 ã€‚å¯ä»¥è¯æ˜ï¼Œ23 æ˜¯å¯ä»¥å®ç°çš„æœ€å°ç­”æ¡ˆã€‚ 
# 
#  ç¤ºä¾‹ 2ï¼š 
#  è¾“å…¥ï¼šn = 2, edges = [[0,1]], price = [2,2], trips = [[0,0]]
# è¾“å‡ºï¼š1
# è§£é‡Šï¼š
# ä¸Šå›¾è¡¨ç¤ºå°†èŠ‚ç‚¹ 0 è§†ä¸ºæ ¹ä¹‹åçš„æ ‘ç»“æ„ã€‚ç¬¬ä¸€ä¸ªå›¾è¡¨ç¤ºåˆå§‹æ ‘ï¼Œç¬¬äºŒä¸ªå›¾è¡¨ç¤ºé€‰æ‹©èŠ‚ç‚¹ 0 å¹¶ä½¿å…¶ä»·æ ¼å‡åŠåçš„æ ‘ã€‚ 
# ç¬¬ 1 æ¬¡æ—…è¡Œï¼Œé€‰æ‹©è·¯å¾„ [0] ã€‚è·¯å¾„çš„ä»·æ ¼æ€»å’Œä¸º 1 ã€‚ 
# æ‰€æœ‰æ—…è¡Œçš„ä»·æ ¼æ€»å’Œä¸º 1 ã€‚å¯ä»¥è¯æ˜ï¼Œ1 æ˜¯å¯ä»¥å®ç°çš„æœ€å°ç­”æ¡ˆã€‚
#  
# 
#  
# 
#  æç¤ºï¼š 
# 
#  
#  1 <= n <= 50 
#  edges.length == n - 1 
#  0 <= ai, bi <= n - 1 
#  edges è¡¨ç¤ºä¸€æ£µæœ‰æ•ˆçš„æ ‘ 
#  price.length == n 
#  price[i] æ˜¯ä¸€ä¸ªå¶æ•° 
#  1 <= price[i] <= 1000 
#  1 <= trips.length <= 100 
#  0 <= starti, endi <= n - 1 
#  
# 
#  Related Topics æ ‘ æ·±åº¦ä¼˜å…ˆæœç´¢ å›¾ æ•°ç»„ åŠ¨æ€è§„åˆ’ ğŸ‘ 73 ğŸ‘ 0

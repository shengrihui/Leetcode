# 2258 é€ƒç¦»ç«ç¾
from typing import *


# leetcode submit region begin(Prohibit modification and deletion)
# class Solution:
#     def maximumMinutes(self, grid: List[List[int]]) -> int:
#         R = 10 ** 9 + 10 ** 5
#         m, n = len(grid), len(grid[0])
#         fire = [[0 if grid[i][j] in [1, 2] else R for j in range(n)] for i in range(m)]
#         q = deque([(i, j, 0) for i in range(m) for j in range(n) if grid[i][j] == 1])
#         while q:
#             x, y, t = q.popleft()
#             for dx, dy in [[1, 0], [-1, 0], [0, 1], [0, -1]]:
#                 nx, ny = x + dx, y + dy
#                 if 0 <= nx < m and 0 <= ny < n and fire[nx][ny] == R:
#                     fire[nx][ny] = t + 1
#                     q.append((nx, ny, t + 1))
#
#         def check(start):
#             v = set()
#             q = deque()
#             if fire[0][0] > start:
#                 q.append((0, 0, start))  # ä» start è¿™ä¸ªæ—¶é—´å‡ºå‘
#                 v.add((0, 0))
#             while q:
#                 x, y, t = q.popleft()
#                 for dx, dy in [[1, 0], [-1, 0], [0, 1], [0, -1]]:
#                     nx, ny = x + dx, y + dy
#                     if nx == m - 1 and ny == n - 1 and fire[nx][ny] >= t + 1:
#                         return True
#                     if 0 <= nx < m and 0 <= ny < n and (nx, ny) not in v and fire[nx][ny] > t + 1:
#                         q.append((nx, ny, t + 1))
#                         v.add((nx,ny))
#             return False
#
#         # l, r = 0, 10 ** 9
#         l, r = 0, min(fire[0][0], 10 ** 9)
#         while l <= r:
#             mid = (r + l) // 2
#             if check(mid):
#                 l = mid + 1
#             else:
#                 r = mid - 1
#         return r

# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def maximumMinutes(self, grid: List[List[int]]) -> int:
        m, n = len(grid), len(grid[0])

        def bfs(q: List[Tuple[int, int]]) -> (int, int, int):
            time = [[-1] * n for _ in range(m)]
            for i, j in q:
                time[i][j] = 0
            t = 1
            while q:
                tmp = q
                q = []
                for x, y in tmp:
                    for dx, dy in [[1, 0], [-1, 0], [0, 1], [0, -1]]:
                        nx, ny = x + dx, y + dy
                        if 0 <= nx < m and 0 <= ny < n and grid[nx][ny] == 0 and time[nx][ny] == -1:
                            time[nx][ny] = t
                            q.append((nx, ny))
                t += 1
            return time[-1][-1], time[-1][-2], time[-2][-1]

        fire_to_house, f1, f2 = bfs([(i, j) for i, row in enumerate(grid) for j, x in enumerate(row) if x == 1])
        man_to_house, m1, m2 = bfs([(0, 0)])
        if man_to_house == -1:  # äººåˆ°ä¸äº†å®‰å…¨å±‹
            return -1
        if fire_to_house == -1:  # ç«åˆ°ä¸äº†å®‰å…¨å±‹ï¼Œäººæ— è®ºæ€æ ·éƒ½èƒ½åˆ°
            return 10 ** 9
        d = man_to_house - fire_to_house
        if d > 0:  # ç«æ¯”äººå…ˆåˆ°ï¼ˆäººçš„æ—¶é—´æ¯”ç«å¤šï¼‰
            return -1
        d = -d
        if m1 != -1 and m1 + d < f1 or m2 != -1 and m2 + d < f2:
            # äººæ¯”ç«å…ˆåˆ°å®‰å…¨å±‹å·¦è¾¹ or ä¸Šè¾¹çš„å…¶ä¸­ä¸€ä¸ªï¼Œå¹¶ä¸”åœ¨é‚£é‡Œç­‰äº† d åˆ†é’Ÿåï¼Œä»ç„¶æ¯”ç«å…ˆåˆ°å®‰å…¨å±‹
            return d
        # äººæ¯”ç«å…ˆåˆ°å®‰å…¨å±‹å·¦è¾¹ or ä¸Šè¾¹çš„å…¶ä¸­ä¸€ä¸ªï¼Œä½†ç­‰äº† d åˆ†é’Ÿåç«å°±ä¼šåˆ°è¿™ä¸ªæ ¼å­ï¼Œæ‰€ä»¥è¦åœ¨ç«æ¥çš„å‰ä¸€æ­¥è¿›å…¥å®‰å…¨å±‹
        return d - 1

# leetcode submit region end(Prohibit modification and deletion)


# ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹å¤§å°ä¸º m x n çš„äºŒç»´æ•´æ•°æ•°ç»„ grid ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªç½‘æ ¼å›¾ã€‚æ¯ä¸ªæ ¼å­ä¸ºä¸‹é¢ 3 ä¸ªå€¼ä¹‹ä¸€ï¼š 
# 
#  
#  0 è¡¨ç¤ºè‰åœ°ã€‚ 
#  1 è¡¨ç¤ºç€ç«çš„æ ¼å­ã€‚ 
#  2 è¡¨ç¤ºä¸€åº§å¢™ï¼Œä½ è·Ÿç«éƒ½ä¸èƒ½é€šè¿‡è¿™ä¸ªæ ¼å­ã€‚ 
#  
# 
#  ä¸€å¼€å§‹ä½ åœ¨æœ€å·¦ä¸Šè§’çš„æ ¼å­ (0, 0) ï¼Œä½ æƒ³è¦åˆ°è¾¾æœ€å³ä¸‹è§’çš„å®‰å…¨å±‹æ ¼å­ (m - 1, n - 1) ã€‚æ¯ä¸€åˆ†é’Ÿï¼Œä½ å¯ä»¥ç§»åŠ¨åˆ° ç›¸é‚» çš„è‰åœ°æ ¼å­ã€‚æ¯æ¬¡ä½ 
# ç§»åŠ¨ ä¹‹å ï¼Œç€ç«çš„æ ¼å­ä¼šæ‰©æ•£åˆ°æ‰€æœ‰ä¸æ˜¯å¢™çš„ ç›¸é‚» æ ¼å­ã€‚ 
# 
#  è¯·ä½ è¿”å›ä½ åœ¨åˆå§‹ä½ç½®å¯ä»¥åœç•™çš„ æœ€å¤š åˆ†é’Ÿæ•°ï¼Œä¸”åœç•™å®Œè¿™æ®µæ—¶é—´åä½ è¿˜èƒ½å®‰å…¨åˆ°è¾¾å®‰å…¨å±‹ã€‚å¦‚æœæ— æ³•å®ç°ï¼Œè¯·ä½ è¿”å› -1 ã€‚å¦‚æœä¸ç®¡ä½ åœ¨åˆå§‹ä½ç½®åœç•™å¤šä¹…ï¼Œä½  æ€»
# æ˜¯ èƒ½åˆ°è¾¾å®‰å…¨å±‹ï¼Œè¯·ä½ è¿”å› 10â¹ ã€‚ 
# 
#  æ³¨æ„ï¼Œå¦‚æœä½ åˆ°è¾¾å®‰å…¨å±‹åï¼Œç«é©¬ä¸Šåˆ°äº†å®‰å…¨å±‹ï¼Œè¿™è§†ä¸ºä½ èƒ½å¤Ÿå®‰å…¨åˆ°è¾¾å®‰å…¨å±‹ã€‚ 
# 
#  å¦‚æœä¸¤ä¸ªæ ¼å­æœ‰å…±åŒè¾¹ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸º ç›¸é‚» æ ¼å­ã€‚ 
# 
#  
# 
#  ç¤ºä¾‹ 1ï¼š 
# 
#  
# 
#  è¾“å…¥ï¼šgrid = [[0,2,0,0,0,0,0],[0,0,0,2,2,1,0],[0,2,0,0,1,2,0],[0,0,2,2,2,0,2],[0
# ,0,0,0,0,0,0]]
# è¾“å‡ºï¼š3
# è§£é‡Šï¼šä¸Šå›¾å±•ç¤ºäº†ä½ åœ¨åˆå§‹ä½ç½®åœç•™ 3 åˆ†é’Ÿåçš„æƒ…å½¢ã€‚
# ä½ ä»ç„¶å¯ä»¥å®‰å…¨åˆ°è¾¾å®‰å…¨å±‹ã€‚
# åœç•™è¶…è¿‡ 3 åˆ†é’Ÿä¼šè®©ä½ æ— æ³•å®‰å…¨åˆ°è¾¾å®‰å…¨å±‹ã€‚ 
# 
#  ç¤ºä¾‹ 2ï¼š 
# 
#  
# 
#  è¾“å…¥ï¼šgrid = [[0,0,0,0],[0,1,2,0],[0,2,0,0]]
# è¾“å‡ºï¼š-1
# è§£é‡Šï¼šä¸Šå›¾å±•ç¤ºäº†ä½ é©¬ä¸Šå¼€å§‹æœå®‰å…¨å±‹ç§»åŠ¨çš„æƒ…å½¢ã€‚
# ç«ä¼šè”“å»¶åˆ°ä½ å¯ä»¥ç§»åŠ¨çš„æ‰€æœ‰æ ¼å­ï¼Œæ‰€ä»¥æ— æ³•å®‰å…¨åˆ°è¾¾å®‰å…¨å±‹ã€‚
# æ‰€ä»¥è¿”å› -1 ã€‚
#  
# 
#  ç¤ºä¾‹ 3ï¼š 
# 
#  
# 
#  è¾“å…¥ï¼šgrid = [[0,0,0],[2,2,0],[1,2,0]]
# è¾“å‡ºï¼š1000000000
# è§£é‡Šï¼šä¸Šå›¾å±•ç¤ºäº†åˆå§‹ç½‘æ ¼å›¾ã€‚
# æ³¨æ„ï¼Œç”±äºç«è¢«å¢™å›´äº†èµ·æ¥ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•ä½ éƒ½èƒ½å®‰å…¨åˆ°è¾¾å®‰å…¨å±‹ã€‚
# æ‰€ä»¥è¿”å› 10â¹ ã€‚
#  
# 
#  
# 
#  æç¤ºï¼š 
# 
#  
#  m == grid.length 
#  n == grid[i].length 
#  2 <= m, n <= 300 
#  4 <= m * n <= 2 * 10â´ 
#  grid[i][j] æ˜¯ 0 ï¼Œ1 æˆ–è€… 2 ã€‚ 
#  grid[0][0] == grid[m - 1][n - 1] == 0 
#  
# 
#  Related Topics å¹¿åº¦ä¼˜å…ˆæœç´¢ æ•°ç»„ äºŒåˆ†æŸ¥æ‰¾ çŸ©é˜µ ğŸ‘ 58 ğŸ‘ 0
